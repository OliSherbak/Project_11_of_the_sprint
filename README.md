**Задача:** построить модель бинарной классификации, которая спрогнозирует вероятность оттока каждого клиента в следующем месяце.# Project_11_of_the_sprint

### Описание данных

Для разработки модели предоставлены данные из внутренних систем компании. База данных  coffee_churn_dataset:
- `coffee_churn_dataset` - содержит данные собранные из внутренних систем компании: транзакционной базы данных, логов мобильного приложения и результатов опросов.

**Описание датасета `coffee_churn_dataset`:**
- `user_id` — идентификатор пользователя.
- `days_since_last_order` — количество дней, прошедших с последнего заказа.
- `order_frequency_month` — среднее число заказов в месяц.
- `order_frequency_week` — среднее число заказов в неделю.
- `avg_order_value` — средний чек, в рублях.
`median_order_value` — медианный чек, в рублях.
- `total_spent_last_month` — сумма заказов за последний месяц.
- `total_spent_last_week` — сумма заказов за последнюю неделю.
- `discount_usage_rate` — доля заказов со скидкой за последний месяц.
- `last_coffee_type` — сорт кофе, купленный пользователем в последний раз на момент сбора данных.
- `preferred_roast` — предпочитаемый тип обжарки.
- `milk_preference` — предпочитаемый тип молока.
- `seasonal_menu_tried` — отметка о том, пробовал ли пользователь новейшее сезонное меню.
- `coffee_bean_origin` — страна происхождения зерна.
- `last_drink_size` — размер последнего заказа, совершённого на момент сбора данных.
- `subscription_status` — тип подписки пользователя.
- `app_opens_per_week` — сколько раз за неделю пользователь в среднем открывал приложение доставки кофе.
- `notifications_enabled` — включены ли у пользователя уведомления.
- `review_rating_last_10` — средняя оценка последних на момент сбора данных десяти заказов клиента.
- `review_rating_last_1` — оценка последнего на момент сбора данных заказа клиента.
- `app_crashes_last_month` — сколько раз приложение зависало за последний месяц.
- `seasons` — текущее время года.
- `days_since_last_promo` — сколько дней прошло с последнего использования акции или промокода.
- `phone_type` — тип устройства, с которого пользователь чаще всего совершал покупки.
- `coffee_preference_change` — менялись ли вкусовые предпочтения пользователя.
- `geo_id` — идентификатор региона пользователя.
- `churn` — перестал ли пользователь пользоваться сервисом.

### Содержимое проекта

1. Подготовка среды и библиотек.
2. Первичный анализ данных.
3. Предобработка данных.
4. Обучение модели.
5. Создание новых признаков.
6. Эксперименты с гиперпараметрами.
7. Подготовка финальной модели.
8. Отчёт о проделанной работе.
9. Сохранение модели для продакшена.

---

Тип модели:
- `линейная модель — LogisticRegression`. 
- В качестве базовой модели - `DummyClassifier`.

Целевая переменная: `churn - перестал ли пользователь пользоваться сервисом.

Метрики качества модели, которые использовались: 
- Precision-Recall AUC (PR AUC).

Занчения у Dummy модели 0.0602. 

Значение LogisticRegression PR-AUC (train_val): 0.6479 что почти в 11 раз выше у модели Dummy.

У Dummy модели почти нулевой разброс **0.0003**, фолды почти не отличаются, поэтому модель всегда предсказывает одно и то же. У LogisticRegression среднее отклонение **0.0422**, умеренное, нет нестабильности и признаков переобучения.

Далее были добавлены новые признаки для улучшения модели. Чтобы увеличить среднее значение или уменьшить среднее отклонение.  

После добавления новых признаков качество модели выросло PR-AUC (train_val) до **0.6669**. 

Далее был проведён анализ коэффициентов , по которому были выявлены такие сильные признаки:
- `app_crashes_last_month` - **+1.93** - Чем больше сбоев, тем выше вероятность ухода
- `subscription_status_pro` - **+0.78** - Чем выше ожидание, тем выше шанс ухода при каких-либо изменениях

Были выявлены средние признаки, которые после были проверены на корреляцию:
- `app_opens_per_week` - **+0.63**
- `subscription_status_none` - **-0.30**
- `order_frequency_week` - **+0.30**
- `subscription_status_basic` - **-0.28**
- `crash_rate` - **-0.21**
- `subscription_status_unknown` - **-0.15**
- `total_spent_last_week` - **+.14**
- `mobile_notifications_off` - **+.12**
- `low_rating_activity` - **+0.10**

Также был проведён анализ корреляции новых признаков и были удалены такие признаки:
- `discount_usage_rate`
- `app_opens_per_week`
- `crash_rate`
- `total_spent_last_week`
- `review_rating_last_10`

Удаление признаков с низким коэффициентом и мультиколиниарностью повысило качество модели до PR-AUC (train_val): **0.6669**. 

Для дальнейшей работы будет выбрана модель с удаления слабых и коррелирующих, так как в данной задаче важен показатель PR-AUC, чем выше, тем лучше.

По итогам перебора гиперпаметров была определена лучшая модель. Лучший результат метрики PR_AUC_mean = 0.6674, с гиперпараметрами:
- C = **0.01**
- penalty = **l2**
- solver = **liblinear**
- class_weight = **balanced**	

Также данная модель показала хорошие результаты **PR-AUC на тестовой выборке: 0.6936** это в 12 раз выше baseline модели. 

Модель хорошо учитывает положительные признаки. При удалении признаков с низким коэффициентом и взаимной корреляцией, а также с оптимальным подбором гиперпараметров, модель стала стабильнее и уменьшился риск переобучения.